<app-doctor-nav></app-doctor-nav>

<div class="appointments-container">
  <mat-card class="appointments-card">
    <mat-card-title class="appointments-title">My Appointments</mat-card-title>
    <mat-card-content>
      <table mat-table [dataSource]="appointments" class="mat-elevation-z2 full-width-table">

        <!-- Appointment ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> ID </th>
          <td mat-cell *matCellDef="let appt"> {{ appt.id }} </td>
        </ng-container>

        <!-- Patient Name -->
        <ng-container matColumnDef="patientName">
          <th mat-header-cell *matHeaderCellDef> Patient </th>
          <td mat-cell *matCellDef="let appt"> {{ appt.patientName }} </td>
        </ng-container>

        <!-- Appointment Date -->
        <ng-container matColumnDef="appointmentDate">
          <th mat-header-cell *matHeaderCellDef> Date </th>
          <td mat-cell *matCellDef="let appt"> {{ appt.appointmentDate | date }} </td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Actions </th>
          <td mat-cell *matCellDef="let appt">
            <button mat-raised-button color="primary" (click)="viewRecords(appt.patientId)">
              {{ expandedRecords[appt.patientId] ? 'Hide Records' : 'View Records' }}
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Medical Records Expanded -->
      <div *ngFor="let appt of appointments">
        <div *ngIf="expandedRecords[appt.patientId]" class="records-box">
          <h4>Medical Records for {{ appt.patientName }}</h4>
          <table class="records-table">
            <tr>
              <th>Disease</th>
              <th>Description</th>
              <th>Date</th>
              <th>Medicines</th>
            </tr>
            <tr *ngFor="let rec of expandedRecords[appt.patientId]">
              <td>{{ rec.disease }}</td>
              <td>{{ rec.description }}</td>
              <td>{{ rec.date | date }}</td>
              <td>{{ rec.medicines }}</td>
            </tr>
          </table>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
